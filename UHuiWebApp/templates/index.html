{% extends "__base__.html" %}
{% block title %}U惠网 {% endblock %}
{% block src %}
    <link rel="stylesheet" type="text/css" href="/static/css/aui/aui-slide.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/dropload.css"/>
{% endblock %}

{% block body %}
    <div class="container">
        <div class="col-xs-1 col-lg-1 col-md-1 col-sm-1 category-left " id="homepage_navigation">
            <ul class="category-menu">
                <!--#homepage_top-->
                <a href="#">
                    <li><img src="/static/images/置顶箭头.png">推荐</li>
                </a>
                <a href="#catid_生活百货">
                    <li><img src="/static/images/生活百货-1.png">百货</li>
                </a>
                <a href="#catid_美妆装饰">
                    <li><img src="/static/images/美妆装饰-1.png">美妆</li>
                </a>
                <a href="#catid_文娱体育">
                    <li><img src="/static/images/文娱体育-1.png">体育</li>
                </a>
                <a href="#catid_家具家居">
                    <li><img src="/static/images/家具家居-1.png">家具</li>
                </a>
                <a href="#catid_电子产品">
                    <li><img src="/static/images/电子产品-1.png">数码</li>
                </a>
                <a href="#catid_服装服饰">
                    <li><img src="/static/images/服装服饰-1.png">服饰</li>
                </a>
                <a href="#catid_旅行住宿">
                    <li><img src="/static/images/旅行住宿-1.png">旅游</li>
                </a>
                <a href="#catid_饮食保健">
                    <li style="border: 0;"><img src="/static/images/饮食保健-1.png">饮食</li>
                </a>
            </ul>
        </div>

        <div class="category-right col-xs-11 col-lg-11 col-md-11 col-sm-11">
            <div id="myCarousel" class="carousel slide">
                <!-- 轮播（Carousel）指标 -->
                <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    <li data-target="#myCarousel" data-slide-to="2"></li>
                </ol>
                <!-- 轮播（Carousel）项目 -->
                <div class="carousel-inner">
                    <div class="item active">
                        <img src="/static/images/dva_1.jpg">
                    </div>
                    <div class="item">
                        <img src="/static/images/dva_2.jpg">
                    </div>
                    <div class="item">
                        <img src="/static/images/dva_3.jpg">
                    </div>
                </div>
                <!-- 轮播（Carousel）导航 -->
                <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
                <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
            </div>


            <div class="row">
                <div class="col-xs-3 col-lg-3 col-md-3 col-sm-3">
                    <a href="#" class="thumbnail">
                        <img src="/static/images/dva_1.jpg" alt="">

                    </a>
                </div>
                <div class="col-xs-3 col-lg-3 col-md-3 col-sm-3">
                    <a href="#" class="thumbnail">
                        <img src="/static/images/dva_1.jpg" alt="">
                    </a>
                </div>
                <div class="col-xs-3 col-lg-3 col-md-3 col-sm-3">
                    <a href="#" class="thumbnail">
                        <img src="/static/images/dva_1.jpg" alt="">
                    </a>
                </div>
                <div class="col-xs-3 col-lg-3 col-md-3 col-sm-3">
                    <a href="#" class="thumbnail">
                        <img src="/static/images/dva_1.jpg" alt="">
                    </a>
                </div>
            </div>
            <hr id="index_home"/>



            {% for key,value in coupons.items() %}
                <div class="row">
                    <h3 class="content-text" style="color: #ff5a00;font-weight: bolder;"
                        id="catid_{{ key }}">{{ key }}</h3>
                    {% for i in value %}
                        <div class="point col-xs-6 col-md-6 col-lg-6 col-sm-6 coupon_detail" id="{{ i.couponID }}">
                            <div class="user-coupons row">
                                <div class="col-xs-3 col-md-3 col-lg-3 col-sm-3 user-coupons-left">
                                    <p class="user-coupons-left-value">
                                        ￥{{ i.listPrice }}
                                    </p>
                                    <p>
                                        估值:￥{{ i.value }}
                                    </p>

                                </div>
                                <div class="col-xs-9 col-md-9 col-lg-9 col-sm-9 user-coupons-middle">
                                    <div class="user-coupons-middle-value col-xs-6 col-md-6 col-lg-6 col-sm-6">
                                        <p class="font-class">
                                            {{ i.brand }}
                                        </p>
                                    </div>
                                    <div class="col-xs-6 col-md-6 col-lg-6 col-sm-6 user-coupons-middle-value">
                                        <p>
                                            {{ i.discount }}
                                        </p>
                                    </div>
                                    <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12 user-coupons-middle-value">
                                        {% for k in i.limits %}
                                            <p class="user-coupons-middle-value-limits-p">{{ k }}</p>
                                        {% endfor %}
                                    </div>


                                </div>

                                <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12 user-coupons-bottom">
                                    <p>截止时间:{{ i.expiredTime }}</p>
                                </div>

                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

        </div>

    </div>
    <div class="modal-wrapper being-hidden">
        <div class="modal-backdrop modal-backdrop-white">
            <div class="index_coupons_detail">
                <div class="row">
                    <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12 content-text ">
                        <div class="coupons_detail_title">
                            优惠券详情
                            <div class="being-hidden" id="couponDetail_ID"></div>
                            <div class="being-hidden" id="couponDetail_sellerID"></div>
                        </div>
                    </div>
                    <div class="clear"></div>
                    <div style="padding: 15px;">
                        <div class="col-xs-4 col-lg-4 col-md-4 col-sm-4">
                            <img src="/static/images/dva_1.jpg" id="couponDetail_image" style="width: 100%;">
                            <div style="padding: 15px;" class="row">
                                <div class="point button col-xs-6 col-lg-6 col-md-6 col-sm-6 col-xs-offset-3 col-lg-offset-3 col-md-offset-3 col-sm-offset-3"
                                     id="couponDetail_like" onclick="post_changelike('post_like')">
                                    关注
                                </div>
                                <div class="point being-hidden button col-xs-6 col-lg-6 col-md-6 col-sm-6 col-xs-offset-3 col-lg-offset-3 col-md-offset-3 col-sm-offset-3"
                                     id="couponDetail_dislike" onclick="post_changelike('post_dislike')">
                                    已关注
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-8 col-lg-8 col-md-8 col-sm-8 row">
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span style="font-size: 20px;color: #ff5a00;" id="couponDetail_name">暑期超值优惠券</span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span style="font-size: 18px;color: #ff5a00;" id="couponDetail_listPrice"></span><span
                                    id="couponDetail_value"></span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span class="float-left">优惠券额度</span> <span class="float-right"
                                                                            id="couponDetail_discount"></span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span class="float-left">商家名</span> <span class="float-right"
                                                                          id="couponDetail_brand"></span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span class="float-left">卖家</span> <span class="float-right"
                                                                         id="couponDetail_sellername"></span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <span class="float-left">到期时间</span> <span class="float-right"
                                                                           id="couponDetail_expiredTime"></span>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12">
                                <p style="margin: 0;">使用限制:</p>
                                <p style="margin: 0;height: 14px;line-height:14px;font-size: 14px;"
                                   id="couponDetail_limits"></p>
                            </div>
                            <div class="col-xs-12 col-lg-12 col-md-12 col-sm-12" id="couponDetail_errormessage"
                                 style="color: red;">

                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="row">
                    <div style="padding: 15px;">
                        <div class="point button col-xs-4 col-lg-4 col-md-4 col-sm-4 col-xs-offset-2 col-lg-offset-2 col-md-offset-2 col-sm-offset-2"
                             onclick="returnindex()">
                            返回
                        </div>
                        <div class="point button col-xs-4 col-lg-4 col-md-4 col-sm-4 col-xs-offset-4 col-lg-offset-4 col-md-offset-4 col-sm-offset-4"
                             id="couponDetail_putonsale"
                             onclick="post_changesalestat('/post_putOnSale','您确定要上架吗？','取消','确定上架')">
                            上架
                        </div>
                        <div class="point being-hidden button col-xs-4 col-lg-4 col-md-4 col-sm-4 col-xs-offset-4 col-lg-offset-4 col-md-offset-4 col-sm-offset-4 "
                             id="couponDetail_putoffsale"
                             onclick="post_changesalestat('/post_putOffSale','您确定要下架吗？','取消','确定下架')">
                            下架
                        </div>
                        <div class="point being-hidden button col-xs-4 col-lg-4 col-md-4 col-sm-4 col-xs-offset-4 col-lg-offset-4 col-md-offset-4 col-sm-offset-4"
                             id="couponDetail_buy" onclick="post_buy()">
                            购买
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">输入您的价格</h4>
                </div>
                <div class="modal-body">
                    <input type="text" id="couponDetail_value">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="buy()">确定上架</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endblock %}
{% block scripts %}
    <script type="text/javascript">
        $(document).ready(function () { //本人习惯这样写了
            $(window).scroll(function () {
                //$(window).scrollTop()这个方法是当前滚动条滚动的距离
                //$(window).height()获取当前窗体的高度
                //$(document).height()获取当前文档的高度
                $("#homepage_navigation").css("top", $(window).scrollTop());
                //当底部基本距离+滚动的高度〉=文档的高度-窗体的高度时；
                //我们需要去异步加载数据了

            });
        });
        $(".coupon_detail").click(function () {
            $(".modal-wrapper").show();
            $("body").css("overflow", "hidden");
            $.ajax({
                type: 'POST',
                url: '/post_couponDetail',
                data: {"couponID": $(this).attr("id")},
                dataType: 'json',
                sync: false,
                success: function (data) {
                    $("#couponDetail_limits").siblings().remove();
                    $("#couponDetail_name")[0].innerText = data.info.product;
                    $("#couponDetail_listPrice")[0].innerText = '￥' + data.info.listPrice;
                    $("#couponDetail_value")[0].innerText = '(￥' + data.info.value + ')';
                    $("#couponDetail_discount")[0].innerText = data.info.discount;
                    $("#couponDetail_brand")[0].innerText = data.info.brand;
                    $("#couponDetail_sellername")[0].innerText = data.info.sellerInfo.nickname;
                    $("#couponDetail_sellerID")[0].innerText = data.info.sellerInfo.userid;
                    $("#couponDetail_expiredTime")[0].innerText = data.info.expiredTime;
                    $("#couponDetail_ID")[0].innerText = data.info.couponID;

                    $.each(data.info.limits, function (key, value) {
                        var $limits = $("#couponDetail_limits").clone();
                        $limits.attr("id", "");
                        $limits[0].innerText = value;
                        $("#couponDetail_limits").after($limits);

                    });
                    getstat(data.stat);

                }
            })

        })

        function getstat(stat) {
            $("#couponDetail_putonsale").hide();
            $("#couponDetail_putoffsale").hide();
            $("#couponDetail_buy").hide();
            $("#couponDetail_like").hide();
            $("#couponDetail_dislike").hide();
            if (stat == "0") {
                $("#couponDetail_buy").show();
                $("#couponDetail_like").show();
            }
            else if (stat == "1") {
                $("#couponDetail_dislike").show();
                $("#couponDetail_buy").show();
            }
            else if (stat == "2") {
                $("#couponDetail_putoffsale").show();
            }
            else if (stat == "3") {
                $("#couponDetail_putonsale").show();
            }
        }

        function returnindex() {
            $(".modal-wrapper").hide();
            $("body").css("overflow", "auto");
        }

        function post_changelike(url) {
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                data: {'couponID': $("#couponDetail_ID")[0].innerText},
                timeout: 3000,
                cache: false,
                success: succFunction
            });

            function succFunction(Jsondata) {
                var msg = Jsondata.message;
                if (Jsondata.errno === '5') {
                    window.location.href = "/login";
                }
                else if (Jsondata.errno === '0') {

                    if (Jsondata.like === '0') {
                        $("#couponDetail_like").show();
                        $("#couponDetail_dislike").hide();
                    }
                    else {
                        $("#couponDetail_like").hide();
                        $("#couponDetail_dislike").show();
                    }

                }
                else {
                    alert(msg)
                }

            }

        }

        function post_buy() {
            $.ajax({
                url: '/post_buy',
                type: 'POST',
                dataType: 'json',
                data: {
                    "couponID": $("#couponDetail_ID")[0].innerText,
                    "sellerID": $("#couponDetail_sellerID")[0].innerText
                },
                timeout: 3000,
                cache: false,
                async: false,
                beforeSend: LoadFunction,
                error: erryFunction,
                success: succFunction
            });

            function LoadFunction() {
            }

            function erryFunction() {
            }

            function succFunction(Jsondata) {
                if (Jsondata.errno === '0') {

                    window.location.href = "/mobile_myboughtcoupons";


                } else {
                    alert(Jsondata.message);

                }

            }

        }

        function isUnsignedInteger(a) {
            var reg = /^[1-9]\d*(.\d{1,2})?$/;
            return reg.test(a);
        }

        function post_changesalestat(url, message, button_left, button_right) {
            if (url === '/post_putOnSale') {
                $('.modal').modal('show');
            }


            else {
                $.confirm(message, '', function () {

                    $.ajax({
                        async: false,
                        url: url,
                        type: 'POST',
                        dataType: 'json',
                        data: {'couponID': $("#couponDetail_ID")[0].innerText},
                        timeout: 3000,
                        cache: false,
                        success: succFunction
                    });


                })
            }
        }

        function succFunction(Jsondata) {
            var msg = Jsondata.message;
            if (Jsondata.errno === '0') {
                    if (Jsondata.stat === 'onSale') {
                         $("#couponDetail_putonsale").hide();
                        $("#couponDetail_putoffsale").show();
                    }
                    else {
                         $("#couponDetail_putonsale").show();
                        $("#couponDetail_putoffsale").hide();
                    }
                    $("#couponDetail_listPrice")[0].innerText = '￥' + Jsondata.listPrice;


            }
            else {
                alert(msg);
            }

        }


        function buy() {
            var value = $("#couponDetail_value")[0].innerText;
            if (isUnsignedInteger(value)) {
                $.ajax({
                    async: false,
                    url: url,
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        'couponID': $("#couponDetail_ID")[0].innerText,
                        'listPrice': value
                    },
                    timeout: 3000,
                    cache: false,
                    success: succFunction
                });
            }
            else {
                alert("请输入正确价格");
            }
        }
    </script>

{% endblock %}


<!-- <div id="aui-slide">
    <div class="aui-slide-wrap" >
        <div class="aui-slide-node">
            <div class="aui-grid">
                <div class="aui-row">
                    <div class="aui-col-xs-4">
                        <div class="aui-badge">88</div>
                        <i class="aui-iconfont aui-icon-home"></i>
                        <div class="aui-grid-label">首页</div>
                    </div>
                    <div class="aui-col-xs-4">
                        <i class="aui-iconfont aui-icon-gear"></i>
                        <div class="aui-grid-label">设置</div>
                    </div>
                    <div class="aui-col-xs-4">
                        <i class="aui-iconfont aui-icon-map"></i>
                        <div class="aui-grid-label">地图</div>
                    </div>
                    <div class="aui-col-xs-4">
                        <i class="aui-iconfont aui-icon-calendar"></i>
                        <div class="aui-grid-label">日历</div>
                    </div>
                    <div class="aui-col-xs-4">
                        <div class="aui-badge"></div>
                        <i class="aui-iconfont aui-icon-date"></i>
                        <div class="aui-grid-label">日期</div>
                    </div>
                    <div class="aui-col-xs-4">
                        <div class="aui-dot"></div>
                        <i class="aui-iconfont aui-icon-cart"></i>
                        <div class="aui-grid-label">购物车</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="aui-slide-node aui-slide-node-middle aui-slide-node-center">
            <div class="aui-content-padded">
                <span class="aui-text-danger">AUI Slide</span> 轮播组件不只局限于放置图片，可以自定义内容，分页样式有圆点(dot)，线条(line),结合AUI Flex来实现图片及内容的水平、垂直居中
            </div>
        </div>
        <div class="aui-slide-node aui-bg-warning aui-slide-node-middle aui-slide-node-center">
            <div class="aui-content-padded">
                <span class="aui-text-danger">AUI Slide</span>提供了常用的配置属性，可以自定义宽度，高度，自动播放，分页器样式等，支持无缝循环轮播
            </div>
        </div>
        <div class="aui-slide-node bg-dark">
            <img src="../../image/l1.png" />
        </div>
        <div class="aui-slide-node bg-dark">
            <img src="../../image/l2.png" />
        </div>
        <div class="aui-slide-node bg-dark">
            <img src="../../image/l3.png" />
        </div>
    </div>
    <div class="aui-slide-page-wrap"></div>
</div>

<script src="/static/js/aui/aui-slide.js"></script>
<script type="text/javascript">
    var slide = new auiSlide({
        container:document.getElementById("aui-slide"),
        // "width":300,
        "height":260,
        "speed":300,
        "autoPlay": 3000,
        "pageShow":true,
        "pageStyle":'dot',
        "loop":true,
        'dotPosition':'center',
        currentPage:currentFun
    });

    function currentFun(index) {
        console.log(index);
    }
</script>
-->
