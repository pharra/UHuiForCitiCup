{% extends "__base__.html" %}
{% block title %}用户中心 {% endblock %}
{% block src %}
{% endblock %}



{% block body %}
    <div class="container" xmlns:v-on="http://www.w3.org/1999/xhtml">
        <div class="row">

            <div class="panel-group col-xs-2 user-left-menu" id="user_menu">

                <!--头像-->
                <div class="username-text-css">
                    <div class="profile-photo-div">
                        <img src="{{ avatar }}">
                    </div>
                    <span>&nbsp;{{ nickname }}</span>
                </div>

                <!--我的优惠菜单栏-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#user_menu" href="#user_own_list"
                               style="display:block;text-align:center">
                                我的优惠
                                <span class="caret"></span></a>
                        </h4>
                    </div>
                    <div class="panel-collapse collapse" id="user_own_list">
                        <div class="panel-body">
                            <li id="own_have" class="point max">当前持有</li>
                            <li id="own_sale" class="point max">正在出售</li>
                            <li id="own_focus" class="point max">我的关注</li>
                        </div>
                    </div>
                </div>

                <!--我的钱包菜单栏-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#user_menu" href="#user_trade_list"
                               style="display:block;text-align:center">
                                我的钱包
                                <span class="caret"></span></a>
                        </h4>
                    </div>
                    <div class="panel-collapse collapse" id="user_trade_list">
                        <div class="panel-body">
                            <li id="tra_balance" class="point max">我的余额</li>
                        </div>
                    </div>
                </div>

                <!--我的消息菜单栏-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#user_menu" href="#user_message_list"
                               style="display:block;text-align:center">
                                我的消息<span class="caret"></span></a>
                        </h4>
                    </div>
                    <div class="panel-collapse collapse" id="user_message_list">
                        <div class="panel-body">
                            <li id="mes_system" class="point max">系统公告</li>
                            <li id="mes_trade" class="point max">交易提示</li>
                        </div>
                    </div>
                </div>

                <!--个人设置菜单栏-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title point max" id="set_content">个人设置</h4>
                    </div>
                </div>

                <!--帮助菜单栏-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title point max" id="hel_content">帮助</h4>
                    </div>
                </div>
                <!--end panel group-->
            </div>

            <div class="col-xs-10">

                <!--我的优惠-->
                <div class="" id="own_menu">

                    <!--选项卡-->
                    <ul class="nav nav-tabs">
                        <li id="info_own_have" class="point active">
                            <a href="#tab_own_have" data-toggle="tab">当前持有</a>
                        </li>
                        <li id="info_own_sale" class="point">
                            <a href="#tab_own_sale" data-toggle="tab">正在出售</a>
                        </li>
                        <li id="info_own_focus" class="point">
                            <a href="#tab_own_focus" data-toggle="tab">我的关注</a>
                        </li>
                    </ul>


                    <!--选项内容-->
                    <div class="tab-content row" id="coupons">
                        <!--当前持有-->
                        <div class="tab-pane fade in active" style="padding-top: 15px;" id="tab_own_have">
                            {% if couponsOwn %}
                                <!--  {% for i in couponsOwn %}
                        <div class="col-xs-6" >
                            <div class="point coupon_detail user-coupons row" id="{{ i.couponID }}">
                                <div class="col-xs-3  user-coupons-left">
                                    <p class="user-coupons-left-value">
                                        ￥{{ i.listPrice }}
                                    </p>
                                    <p>
                                        估值:￥{{ i.value }}
                                    </p>

                                </div>
                                <div class="col-xs-9 user-coupons-middle">
                                    <div class="user-coupons-middle-value col-xs-6">
                                        <p class="font-class">
                                            {{ i.brand }}
                                        </p>
                                    </div>
                                    <div class="col-xs-6  user-coupons-middle-value">
                                        <p>
                                            {{ i.discount }}
                                        </p>
                                    </div>
                                    <div class="col-xs-12  user-coupons-middle-value">
                                        {% for k in i.limits %}
                                        <p class="user-coupons-middle-value-limits-p">{{ k }}</p>
                                        {% endfor %}
                                    </div>


                                </div>

                                <div class="col-xs-12  user-coupons-bottom">
                                    <p>截止时间:{{ i.expiredTime }}</p>
                                </div>

                            </div>
                        </div>
                        {% endfor %} -->
                            {% else %}
                                <div class="content-text">
                                    <img src="/static/images/coupons_empty.png">
                                    <p>什么！？这里居然是空的！</p>
                                </div>
                            {% endif %}
                            <coupon v-for="coupon in couponsOwn" :coupon="coupon"></coupon>
                        </div>

                        <!--正在出售-->
                        <div class="tab-pane fade" style="padding-top: 15px;" id="tab_own_sale">
                            {% if couponsOnSale %}
                                <!--    {% for i in couponsOnSale %}
                        <div class="col-xs-6" >
                            <div class="point coupon_detail user-coupons row" id="{{ i.couponID }}">
                                <div class="col-xs-3  user-coupons-left">
                                    <p class="user-coupons-left-value">
                                        ￥{{ i.listPrice }}
                                    </p>
                                    <p>
                                        估值:￥{{ i.value }}
                                    </p>

                                </div>
                                <div class="col-xs-9 user-coupons-middle">
                                    <div class="user-coupons-middle-value col-xs-6 ">
                                        <p class="font-class">
                                            {{ i.brand }}
                                        </p>
                                    </div>
                                    <div class="col-xs-6  user-coupons-middle-value">
                                        <p>
                                            {{ i.discount }}
                                        </p>
                                    </div>
                                    <div class="col-xs-12 user-coupons-middle-value">
                                        {% for k in i.limits %}
                                        <p class="user-coupons-middle-value-limits-p">{{ k }}</p>
                                        {% endfor %}
                                    </div>


                                </div>

                                <div class="col-xs-12  user-coupons-bottom">
                                    <p>截止时间:{{ i.expiredTime }}</p>
                                </div>

                            </div>
                        </div>
                        {% endfor %} -->
                            {% else %}
                                <div class="content-text">
                                    <img src="/static/images/coupons_empty.png">
                                    <p>什么！？这里居然是空的！</p>
                                </div>
                            {% endif %}
                            <coupon v-for="coupon in couponsOnSale" :coupon="coupon"></coupon>
                        </div>

                        <!--我的关注-->
                        <div class="tab-pane fade" style="padding-top: 15px;" id="tab_own_focus">
                            {% if couponsLike %}
                                <!--    {% for i in couponsLike %}
                        <div class=" col-xs-6" >
                            <div class="point coupon_detail user-coupons row" id="{{ i.couponID }}">
                                <div class="col-xs-3 user-coupons-left">
                                    <p class="user-coupons-left-value">
                                        ￥{{ i.listPrice }}
                                    </p>
                                    <p>
                                        估值:￥{{ i.value }}
                                    </p>

                                </div>
                                <div class="col-xs-9  user-coupons-middle">
                                    <div class="user-coupons-middle-value col-xs-6">
                                        <p class="font-class">
                                            {{ i.brand }}
                                        </p>
                                    </div>
                                    <div class="col-xs-6  user-coupons-middle-value">
                                        <p>
                                            {{ i.discount }}
                                        </p>
                                    </div>
                                    <div class="col-xs-12 user-coupons-middle-value">
                                        {% for k in i.limits %}
                                        <p class="user-coupons-middle-value-limits-p">{{ k }}</p>
                                        {% endfor %}
                                    </div>


                                </div>

                                <div class="col-xs-12 user-coupons-bottom">
                                    <p>截止时间:{{ i.expiredTime }}</p>
                                </div>

                            </div>
                        </div>
                        {% endfor %} -->
                            {% else %}
                                <div class="content-text">
                                    <img src="/static/images/coupons_empty.png">
                                    <p>什么！？这里居然是空的！</p>
                                </div>
                            {% endif %}
                            <coupon v-for="coupon in couponsLike" :coupon="coupon"></coupon>
                        </div>

                        <!--end tab-content-->
                    </div>
                    <!--end own_menu-->
                </div>

                <!--我的钱包-->
                <div class="being-hidden" id="tra_menu">

                    <!--选项卡-->
                    <ul class="nav nav-tabs">
                        <li id="info_tra_balance" class="point active">
                            <a href="#tab_tra_balance" data-toggle="tab">我的余额</a>
                        </li>

                    </ul>

                    <hr/>

                    <!--选项内容-->
                    <div class="tab-content">
                        <div class="tab-pane fade in active" id="tab_tra_balance">
                            <p>U币余额:{{ UCoin }}</p>
                            <div class="button point">充值</div>
                        </div>


                    </div>
                    <!--end tra_menu-->
                </div>

                <!--我的消息-->
                <div class="being-hidden" id="mes_menu">

                    <!--选项卡-->
                    <ul class="nav nav-tabs">
                        <li id="info_mes_system" class="point active">
                            <a href="#tab_mes_system" data-toggle="tab">系统公告</a>
                        </li>
                        <li id="info_mes_trade" class="point">
                            <a href="#tab_mes_trade" data-toggle="tab">交易信息</a>
                        </li>
                    </ul>

                    <hr/>

                    <!--选项内容-->
                    <div class="tab-content">
                        <div class="tab-pane fade in active" id="tab_mes_system">
                            <p>system</p>
                        </div>

                        <div class="tab-pane fade" id="tab_mes_trade">
                            <p>trade</p>
                        </div>
                    </div>
                    <!--end mes_menu-->
                </div>


                <div class="being-hidden" id="set_menu">
                    <ul class="nav nav-tabs">
                        <li id="info_set_content" class="point active">
                            <a href="#tab_set_content" data-toggle="tab">个人资料</a>
                        </li>
                    </ul>

                    <div class="tab-content userinfo-setting-body">
                        <div class="tab-pane fade in active" id="tab_set_content">
                            {% raw %}
                                <form class="form-horizontal" id="changeuserinfo">
                                    <div class="form-group">
                                        <label for="newname" class="col-xs-2  control-label">昵称</label>
                                        <div class="col-xs-5 control-label">
                                            <div>
                                                <span>{{ nickname }}</span>
                                                <i class="fa fa-pencil-square-o point edituserinfo"
                                                   v-on:click="changeUserInfo('nickname','修改昵称','输入你的新昵称')"
                                                   aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newname" class="col-xs-2  control-label">密码</label>
                                        <div class="col-xs-5 control-label">
                                            <div>
                                                <span>{{ password }}</span>
                                                <i class="fa fa-pencil-square-o point edituserinfo"
                                                   v-on:click="changeUserInfo('password','修改密码','输入你的新密码')"
                                                   aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newname" class="col-xs-2  control-label">邮箱</label>
                                        <div class="col-xs-5 control-label">
                                            <div>
                                                <span>{{ email }}</span>
                                                <i class="fa fa-pencil-square-o point edituserinfo"
                                                   v-on:click="changeUserInfo('email','修改邮箱','输入你的新邮箱')"
                                                   aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="newname" class="col-xs-2  control-label">手机号</label>
                                        <div class="col-xs-5 control-label">
                                            <div>
                                                <span>{{ phoneNum }}</span>
                                                <i class="fa fa-pencil-square-o point edituserinfo"
                                                   v-on:click="changeUserInfo('phoneNum','修改手机号','输入你的新手机号')"
                                                   aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <!--       <div class="form-group being-hidden">
                                       <lable for="newsex" class="col-md-2 control-label"><b>性别</b></lable>
                                       <div>
                                           <label class="checkbox-inline">
                                               <input type="radio" name="newsex" id="newmale" value="male">
                                               男
                                           </label>
                                           <label class="checkbox-inline">
                                               <input type="radio" name="newsex" id="newfemale" value="female">
                                               女
                                           </label>
                                       </div>
                                   </div>
                                    <hr/>
                                    <div class="col-xs-2 being-hidden" id="edit-userinfo-commit-div">
                                        <button type="button" class="button" onclick="func_edit_userinfo_submit();"
                                                id="edit_userinfo_submit">提交修改
                                        </button>
                                    </div>
                                    -->
                                </form>
                            {% endraw %}
                        </div>
                    </div>
                </div>

                <div class="being-hidden" id="hel_menu">
                    <ul class="nav nav-tabs">
                        <li id="info_hel_content" class="point active">
                            <a href="#tab_hel_content" data-toggle="tab">帮助信息</a>
                        </li>
                    </ul>

                    <div class="tab-content" id="tab_hel_content ">
                        <div class="tab-pane fade in active ">
                            <p>help</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script type="text/javascript">
        new Vue({
            el: '#coupons',
            data: {
                "couponsOwn":{{ couponsOwn | safe }},
                "couponsOnSale":{{ couponsOnSale | safe }},
                "couponsLike": {{ couponsLike |safe }}
            }
        });
    </script>
    <script type="text/javascript">
        var userinfo = new Vue({
            el: '#changeuserinfo',
            data: {
                nickname: '{{ nickname }}',
                password: ' ',
                email: '{{ email }}',
                phoneNum: '{{ phoneNum }}'
            },
            methods: {
                changeUserInfo: function (keyWord, title, content) {
                    var _self = this;
                    var postData = {};
                    var setting = {
                        title: title,
                        content: content,
                        onOk: function () {
                            var message = this.message;
                            postData[keyWord] = message;
                            $.ajax({
                                url: '/post_modifyUserInfo',
                                type: 'POST',
                                dataType: 'json',
                                data: postData,
                                timeout: 3000,
                                cache: false,
                                async:false,
                                success: function (data) {
                                    if(data.errno === '0'){
                                        _self[keyWord] = message;
                                    }
                                    vuealert.alert({title: title, content: data.message});
                                }
                            });
                        }
                    };
                    var passwordsetting = {
                        title: '修改密码',
                        content1: '输入旧密码',
                        content2: '输入新密码',
                        onOk: function () {
                            var oldpw = this.oldPassword;
                            var newpw = this.newPassword1;
                            oldpw = $.md5(oldpw + 'UHui');
                            newpw = $.md5(newpw + 'UHui');
                            postData.oldPassword = oldpw;
                            postData[keyWord] = newpw;
                            $.ajax({
                                url: '/post_modifyUserInfo',
                                type: 'POST',
                                dataType: 'json',
                                data: postData,
                                timeout: 3000,
                                cache: false,
                                async:false,
                                success: function (data) {
                                    vuealert.alert({title: title, content: data.message});
                                }
                            });
                        }
                    };
                    if (keyWord === 'password') {
                        vuePwdInput.alert(passwordsetting);
                    }
                    else {
                        vueinput.alert(setting);
                    }
                }
            }
        });
    </script>
{% endblock %}